{"version":3,"sources":["../../Scripts/app/kernel/editors/catalog-editor.component.ts"],"names":[],"mappings":"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","file":"catalog-editor.component.js","sourcesContent":["import { Component, EventEmitter, Input, Output, ViewChild, OnInit, ChangeDetectionStrategy } from '@angular/core';\r\nimport { Router, ActivatedRoute, Params } from '@angular/router';\r\nimport { Location } from '@angular/common';\r\nimport { NgForm, FormGroup, FormBuilder, FormControl } from '@angular/forms';\r\n//\r\nimport { EditorEventArgs } from './editor-event-args';\r\nimport { CatalogInfo, CatalogService } from '../entities';\r\nimport { CatalogOptions } from '../custom/custom-catalog';\r\nimport { Context } from '../context';\r\nimport { SearchRequest } from '../search/search-request';\r\nimport { GridFilter } from '../utils/grid-filter';\r\nimport { Alert } from '../utils/alert';\r\n\r\n@Component({\r\n    moduleId: module.id,\r\n    selector: 'azteca-catalog-editor',\r\n    templateUrl: './catalog-editor.component.html',\r\n    changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class CatalogEditorComponent {\r\n    identity: number;\r\n    readonlyMode: boolean = false;\r\n    alerts: Alert[] = [];\r\n    widthClass: string[] = [];\r\n    defaultOptions: CatalogOptions = { codigoAutogenerado: false };\r\n    //\r\n    @Input() info: CatalogInfo;\r\n    @Input() title: string;            \r\n    @Input() catalogForm: FormGroup;\r\n    @Input() enabled: boolean = true;\r\n    //\r\n    @Output() configureCatalog: EventEmitter<CatalogOptions> = new EventEmitter<CatalogOptions>();\r\n    @Output() creatingItem: EventEmitter<void> = new EventEmitter<void>();\r\n    @Output() viewingItem: EventEmitter<number> = new EventEmitter<number>();\r\n    @Output() loadingItem: EventEmitter<number> = new EventEmitter<number>();\r\n    @Output() cloningItem: EventEmitter<number> = new EventEmitter<number>();\r\n    @Output() savingItem: EventEmitter<EditorEventArgs> = new EventEmitter<EditorEventArgs>();\r\n\r\n    constructor(\r\n        private router: Router,\r\n        private route: ActivatedRoute,\r\n        private location: Location,\r\n        private context: Context,\r\n        private catalogService: CatalogService<CatalogInfo>)\r\n    {\r\n    }\r\n\r\n    ngOnInit() {\r\n        //Establecer el ancho establecido para la aplicación\r\n        this.widthClass.push(this.context.app.defaultWidth);\r\n        //\r\n        let cloneId: number = 0;\r\n\r\n        this.route.params.forEach((params: Params) => {\r\n            this.identity = +params['id'];\r\n            if (params['cloneId']) cloneId = +params['cloneId'];\r\n            if (params['readonly']) this.readonlyMode = params['readonly'] == \"true\" ? true : false;\r\n        });        \r\n\r\n        //Si identity es mayor a cero, se solicitará carga de información. Si es cero, se creará un nuevo elemento\r\n        if (this.identity > 0) {\r\n            if (this.readonlyMode)\r\n                this.viewingItem.next(this.identity);\r\n            else\r\n                this.loadingItem.next(this.identity);\r\n        }\r\n        else {\r\n            //Determinar si el nuevo elemento será en blanco o se clonará de otro elemento\r\n            if (cloneId == 0)\r\n                this.creatingItem.next();\r\n            else\r\n                this.cloningItem.next(cloneId);\r\n        }\r\n    }\r\n\r\n    ngAfterViewInit() {\r\n        setTimeout(_ => this.loadConfiguration());\r\n    }\r\n\r\n    loadConfiguration() {\r\n        //Cargar configuración del catálogo\r\n        this.context.app.showSpinner();\r\n        this.catalogService.getOptions()\r\n            .then(options => {\r\n                if (options != null)\r\n                    this.configureCatalog.next(options);\r\n                else {\r\n                    this.configureCatalog.next(this.defaultOptions);\r\n                }\r\n                this.context.app.hideSpinner();\r\n            })\r\n            .catch(error => this.handleError(error));\r\n    }\r\n\r\n    showAlert(message: string, type: string) {\r\n        let newAlert: Alert = { msg: message, type: type, dismissOnTimeout: 5000, closable: true };\r\n        this.alerts.push(newAlert);\r\n    }\r\n\r\n    public closeAlert(i: number): void {\r\n        this.alerts.splice(i, 1);\r\n    }\r\n\r\n\r\n    private saveHandler() {\r\n        this.onSaveItem(false);\r\n    }\r\n\r\n    private saveCloseHanlder() {\r\n        this.onSaveItem(true);\r\n    }\r\n\r\n    protected onSaveItem(closeEditor: boolean) {\r\n        if (this.catalogForm.valid) {\r\n            let args: EditorEventArgs = { info: this.info, closeEditor: closeEditor };\r\n            this.savingItem.next(args);\r\n        }\r\n        else {\r\n            this.showAlert(\"Uno o varios campos no cumplen con las validaciones\", \"danger\");\r\n        }\r\n    }\r\n\r\n    closeEditor() {\r\n        this.location.back();\r\n    }\r\n\r\n    private handleError(error: any) {\r\n        this.context.app.hideSpinner();\r\n    }\r\n\r\n\r\n}"]}